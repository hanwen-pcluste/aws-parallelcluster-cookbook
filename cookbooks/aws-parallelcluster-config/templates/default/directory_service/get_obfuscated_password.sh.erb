#!/bin/bash

set -ex

LDAP_UNOBFUSCATED_PASSWORD=$(aws secretsmanager get-secret-value --secret-id <%=  node['cluster']["directory_service"]["password_secret_arn"] %> --region <%= node['cluster']['region'] %> --query 'SecretString')

LDAP_OBFUSCATED_PASSWORD=$(python -c "import pysss;print(pysss.password().encrypt('${LDAP_UNOBFUSCATED_PASSWORD}', pysss.password().AES_256))")

echo ${LDAP_OBFUSCATED_PASSWORD}